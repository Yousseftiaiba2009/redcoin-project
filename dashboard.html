<script>
    const API_URL = "https://rtc-miner-server.onrender.com";
    let localBalance = 0;
    let serverMiningSpeed = 0.05; // السرعة المتفق عليها في السيرفر
    let syncInterval;

    window.addEventListener('DOMContentLoaded', () => {
        const savedName = localStorage.getItem('rtc_user') || 'Founder';
        document.getElementById('display-username').innerText = `@${savedName.toLowerCase()}`;
        document.getElementById('user-initial').innerText = savedName.charAt(0).toUpperCase();
        
        // جلب أول بيانات من السيرفر
        fetchInitialData();
        
        // المزامنة الدورية مع السيرفر (كل 5 ثوانٍ لتأكيد الرقم النهائي)
        setInterval(fetchInitialData, 5000);
        
        // تحديث الواجهة بصرياً كل 100 ملي ثانية لضمان سلاسة العداد
        setInterval(updateUI, 100);
    });

    async function fetchInitialData() {
        try {
            // استخدام Cache Busting لضمان عدم جلب بيانات قديمة
            const response = await fetch(`${API_URL}/founder_data?cache=${Date.now()}`);
            const data = await response.json();
            
            if(data.balance) {
                // تحديث الرصيد المحلي ليتطابق مع "الحقيقة" في السيرفر
                localBalance = parseFloat(data.balance);
                
                document.getElementById('txt-conn').innerText = "Mainnet Synced";
                document.getElementById('txt-conn').style.color = "#0ecb81";
                document.getElementById('hash-rate').innerText = "Turbo (0.05/s)";
            }
        } catch (error) {
            document.getElementById('txt-conn').innerText = "Connecting...";
            document.getElementById('txt-conn').style.color = "#ffb100";
        }
    }

    function updateUI() {
        if (localBalance > 0) {
            // إضافة الزيادة الطفيفة بصرياً (0.05 تقسيم 10 لأننا نحدث 10 مرات في الثانية)
            localBalance += (serverMiningSpeed / 10);
            
            const balanceElement = document.getElementById('db-balance');
            balanceElement.innerText = localBalance.toLocaleString(undefined, {
                minimumFractionDigits: 4,
                maximumFractionDigits: 4
            }) + " RTC";
            
            // تحديث القيمة التقريبية بالدولار
            document.getElementById('usd-val').innerText = (localBalance * 0.05).toLocaleString();
        }
    }

    function startMining() {
        // تنبيه المؤسس بأن النظام يعمل بالفعل في الخلفية (Cloud)
        alert("Cloud Mining is active 24/7. Your balance is safe on the blockchain.");
    }

    function openModal(id) { document.getElementById(id).style.display = 'block'; }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }
</script>
